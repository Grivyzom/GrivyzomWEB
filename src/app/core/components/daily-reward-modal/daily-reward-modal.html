@if (isOpen()) {
  <div class="modal-overlay" (click)="close()">
    <div class="modal-container" (click)="onModalContentClick($event)">

      <!-- Close button -->
      <button class="modal-close" (click)="close()" aria-label="Cerrar">
        <lucide-icon [img]="icons.X" [size]="20"></lucide-icon>
      </button>

      @if (!showSuccess()) {
        <!-- Reward Available State -->
        <div class="modal-content">
          <!-- Gift Icon Animation -->
          <div class="gift-icon-container">
            <div class="gift-icon-glow"></div>
            <lucide-icon [img]="icons.Gift" [size]="64" class="gift-icon"></lucide-icon>
          </div>

          <!-- Title -->
          <h2 class="modal-title">Â¡Recompensa Diaria Disponible!</h2>
          <p class="modal-subtitle">Reclama tus Grovs de hoy</p>

          <!-- Reward Breakdown -->
          <div class="reward-breakdown">
            <div class="reward-item">
              <span class="reward-label">Recompensa Base</span>
              <span class="reward-value">{{ projectedReward().grovs_amount }} ðŸ’Ž</span>
            </div>

            @if ((projectedReward().streak_bonus ?? 0) > 0) {
              <div class="reward-item bonus">
                <span class="reward-label">
                  <lucide-icon [img]="icons.TrendingUp" [size]="16"></lucide-icon>
                  Bonus de Racha ({{ currentStreak() }} dÃ­as)
                </span>
                <span class="reward-value">+{{ projectedReward().streak_bonus }} ðŸ’Ž</span>
              </div>
            }

            <div class="reward-divider"></div>

            <div class="reward-item total">
              <span class="reward-label">Total</span>
              <span class="reward-value highlight">{{ projectedReward().total_grovs }} ðŸ’Ž</span>
            </div>
          </div>

          <!-- Streak Progress -->
          @if (nextMilestone()) {
            <div class="streak-section">
              <div class="streak-header">
                <span class="streak-label">
                  <lucide-icon [img]="icons.Trophy" [size]="16"></lucide-icon>
                  PrÃ³ximo Hito
                </span>
                <span class="streak-days">{{ currentStreak() }} / {{ nextMilestone()!.days }} dÃ­as</span>
              </div>

              <!-- Progress Bar -->
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="milestoneProgress()"></div>
              </div>

              <p class="milestone-info">
                {{ nextMilestone()!.title }} - <strong>+{{ nextMilestone()!.bonus_grovs }} ðŸ’Ž</strong>
              </p>
            </div>
          } @else {
            <div class="streak-section completed">
              <p class="milestone-completed">
                <lucide-icon [img]="icons.Trophy" [size]="20"></lucide-icon>
                Â¡Has completado todos los hitos! ðŸŽ‰
              </p>
            </div>
          }

          <!-- Claim Button -->
          <button
            class="claim-btn"
            [disabled]="isClaiming()"
            (click)="claimReward()">
            @if (isClaiming()) {
              <span class="spinner"></span>
              <span>Reclamando...</span>
            } @else {
              <span>Â¡Reclamar Recompensa!</span>
            }
          </button>
        </div>
      } @else {
        <!-- Success State -->
        <div class="modal-content success">
          <!-- Success Icon -->
          <div class="success-icon-container">
            <div class="success-checkmark">
              <svg viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
              </svg>
            </div>
          </div>

          <!-- Success Message -->
          <h2 class="modal-title success-title">Â¡Recompensa Reclamada!</h2>

          @if (claimedReward()) {
            <div class="success-amount">
              <span class="amount-earned">+{{ claimedReward()!.total }}</span>
              <span class="grovs-icon">ðŸ’Ž</span>
            </div>

            @if (claimedReward()!.bonus > 0) {
              <p class="success-streak">
                ðŸ”¥ Racha de {{ claimedReward()!.streak }} dÃ­as
              </p>
            }
          }

          <p class="success-message">
            Vuelve maÃ±ana para seguir tu racha
          </p>
        </div>
      }
    </div>
  </div>
}
